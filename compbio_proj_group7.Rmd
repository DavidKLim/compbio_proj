---
title: "compbio_proj"
author: "David Lim, Mark He, Mike Lafferty"
date: "`r format(Sys.time(), '%m/%d/%Y')`"
output: html_document
---

Figure 1C:

```{r}
library(readxl)
library(genefilter)

X <- read_excel("rnaseq_CNS_all.xlsx")

# filter out genes with 0 SD (or 0 variance)
X.SDs <- rowSds(X[,2:15])
good = (X.SDs!=0)

X = X[good,]

```

```{r}
cor_mat = cor(X[,2:15],method="spearman")
library(pheatmap)
pheatmap(cor_mat)
```

Figure 1D:

```{r}
sel_genes = c("Gfap","Aldh1l1","Slc1a3","Aqp4","Tubb3",
              "Stmn2","Snap25","Eno2","Syn1","Pdgfra",
              "Cspg4","Enpp6","Nfasc","Pip","Mog","Mbp",
              "Mobp","Ccl3","Itgam","Tnf","Cldn5","Flt1","Esam")

sel_X <- X[X$gene.symbol %in% sel_genes,1:15]  # subsetting genes and omitting WB1,2,3
sel_Xcts <- sel_X[,-1]                       # subset just the counts

sel_means <- rowMeans(sel_Xcts)
sel_sd <- rowSds(sel_Xcts)


num_sd <- matrix(0,nrow=nrow(sel_Xcts),ncol=ncol(sel_Xcts))
for(i in 1:nrow(sel_Xcts)){
  num_sd[i,] <- (as.numeric(sel_Xcts[i,]) - sel_means[i])/sel_sd[i]    # calculate # of SD's away from rowMean
}

rownames(num_sd) <- as.matrix(sel_X[,1])
colnames(num_sd) <- colnames(sel_X[,-1])

pheatmap(num_sd[-17,])

##### ISSUES TO RESOLVE: #####
# "Pip" gene has count all = 0.1 --> sd = Inf ??? (row 17)
# Max SDs is 2 in figure. 3 here
# Need to reorder sel_X or num_sd to match the figure
```

Note: "Cd11b" not found. Different name: "Itgam"





FIGURE 3B using Row variances instead of "enrichment":
```{r}
# Using genes with top 40 row variances
std.dev <- rowSds(X[,2:15])
sel.X <- X[which(order(std.dev)<=40),]

hc = hclust(dist(t(sel.X[,2:15])))
plot(hc)
```

```{r}
genes <- sel.X[,1]
sel.X <- sel.X[,2:15]

sel_means <- rowMeans(sel.X)
sel_sd <- rowSds(sel.X)

num_sd <- matrix(0,nrow=nrow(sel.X),ncol=ncol(sel.X))
for(i in 1:nrow(sel.X)){
  num_sd[i,] <- (as.numeric(sel.X[i,]) - sel_means[i])/sel_sd[i]    # calculate # of SD's away from rowMean
}

rownames(num_sd) = as.matrix(genes)
colnames(num_sd) = colnames(sel.X)

dists = dist(num_sd)
hc = hclust(dists)
dend = as.dendrogram(hc)

row_order <- 1:ncol(num_sd)
heatmap(t(num_sd),Rowv=c(12,11,10,9,14,13,6,5,4,3,2,1,8,7),Colv=dend,scale="none")
```